#!/usr/bin/env tsx

/**
 * Bangkok Sync Execution Script
 * 
 * This script executes the Bangkok sync and demonstrates the MatchScore service
 * Run with: npx tsx src/scripts/execute-bangkok-sync.ts
 */

import { executeBangkokSync, getFirstFiveBangkokPlaces } from "@/services/bangkok-sync";
import { calculateMatchScore } from "@/services/discovery/matching.service";

async function main() {
  console.log("ðŸŒŸ BANGKOK SYNC & MATCHSCORE EXECUTION ðŸŒŸ");
  console.log("=" .repeat(50));

  try {
    // Task A: Execute Bangkok Sync
    console.log("\nðŸ“¡ TASK A: EXECUTING BANGKOK SYNC");
    console.log("-".repeat(30));
    
    const syncResults = await executeBangkokSync();
    
    console.log("\nðŸ“Š SYNC RESULTS:");
    console.log(`Total places synced: ${syncResults.totalSynced}`);
    console.log("Breakdown by interest:");
    
    Object.entries(syncResults.placesByInterest).forEach(([interest, count]) => {
      console.log(`  â€¢ ${interest}: ${count} places`);
    });

    if (syncResults.errors.length > 0) {
      console.log("\nâš ï¸  Errors encountered:");
      syncResults.errors.forEach(error => console.log(`  â€¢ ${error}`));
    }

    // Task B: Test MatchScore Service
    console.log("\nðŸ§® TASK B: TESTING MATCHSCORE SERVICE");
    console.log("-".repeat(30));

    // Get the first 5 places for testing
    const firstFivePlaces = await getFirstFiveBangkokPlaces();
    
    if (firstFivePlaces.length === 0) {
      console.log("âŒ No places found to test MatchScore service");
      return;
    }

    console.log(`\nðŸ“ Found ${firstFivePlaces.length} places for MatchScore testing:`);

    // Test with different user personas
    const testPersonas = [
      {
        name: "Budget Traveler",
        interests: ["street_food_markets", "coworking_spaces"],
        budget: "budget",
        travelStyle: ["solo", "backpacker"]
      },
      {
        name: "Luxury Seeker", 
        interests: ["rooftop_bars"],
        budget: "luxury",
        travelStyle: ["luxury", "solo"]
      },
      {
        name: "Digital Nomad",
        interests: ["coworking_spaces", "rooftop_bars"],
        budget: "moderate",
        travelStyle: ["remote", "solo"]
      }
    ];

    firstFivePlaces.forEach((place, index) => {
      console.log(`\n${index + 1}. ðŸ¢ ${place.name}`);
      console.log(`   ðŸ“ Address: ${place.address || 'N/A'}`);
      console.log(`   ðŸ·ï¸  Tags: ${place.tags?.join(', ') || 'None'}`);
      console.log(`   ðŸ’° Price Level: ${place.priceLevel || 'N/A'}`);
      console.log(`   â­ Rating: ${place.rating || 'N/A'}`);
      console.log(`   ðŸ¤– Auto-created: ${place.autoCreated}`);
      console.log(`   ðŸ‘ï¸  Needs Review: ${place.needsReview}`);
      
      // Test MatchScore with each persona
      testPersonas.forEach(persona => {
        const matchResult = calculateMatchScore(persona, place);
        console.log(`   ðŸŽ¯ ${persona.name}: ${matchResult.score}% (${getScoreLabel(matchResult.score)})`);
        
        if (matchResult.breakdown.interests > 0) {
          console.log(`      â€¢ Interest match: ${matchResult.breakdown.interests}%`);
        }
        if (matchResult.breakdown.budget > 0) {
          console.log(`      â€¢ Budget fit: ${matchResult.breakdown.budget}%`);
        }
        if (matchResult.breakdown.vibe > 0) {
          console.log(`      â€¢ Vibe score: ${matchResult.breakdown.vibe}%`);
        }
      });
    });

    // Final Report
    console.log("\nðŸ“‹ FINAL REPORT");
    console.log("=" .repeat(50));
    console.log("âœ… Bangkok Sync completed successfully");
    console.log("âœ… MatchScore service is operational");
    console.log("âœ… MatchScoreBadge component is ready for UI integration");
    
    console.log(`\nðŸŽ‰ SUMMARY:`);
    console.log(`â€¢ ${syncResults.totalSynced} places synced to Bangkok`);
    console.log(`â€¢ ${firstFivePlaces.length} places available for MatchScore testing`);
    console.log(`â€¢ MatchScore service supports 3 matching criteria (Interests, Budget, Vibe)`);
    console.log(`â€¢ UI component ready with color-coded scoring system`);

  } catch (error) {
    console.error("âŒ EXECUTION FAILED:", error);
    process.exit(1);
  }
}

function getScoreLabel(score: number): string {
  if (score >= 80) return 'High';
  if (score >= 50) return 'Medium';
  return 'Low';
}

// Run the script
if (require.main === module) {
  main().catch(console.error);
}
