// ============================================
// USER DOMAIN
// ============================================
// User accounts and extended profile information

/**
 * -------------------------- USER ---------------------------
 */
model User {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  /* ---- INFO ---- */
  email            String?   @unique
  role             Role      @default(USER)
  name             String?
  passwordHash     String?
  avatarUrl        String?   
  emailVerified    DateTime?
  profileCompleted Boolean   @default(false)
  isBanned         Boolean   @default(false)
  isActive         Boolean   @default(true)
  // Refactored Media Relations
  media        Media[] // Media uploaded by this user

  /* ---- PROFILE ---- */
  profile      UserProfile?

  /* ---- LOCATION ---- */
  currentLocation Json? // [lng, lat]
  currentCityId   String? @db.ObjectId
  currentCity     City?   @relation("CurrentLocation", fields: [currentCityId], references: [id])

 /* ---- TRAVEL ---- */
  visitedCountries String[] @default([])
  cityVisits CityVisit[]

  /* ---- FRIENDSHIP ---- */
  friendshipsRequested Friendship[] @relation("FriendshipsRequested")
  friendshipsReceived  Friendship[] @relation("FriendshipsReceived")

  /* ---- CHAT ---- */
  chats        ChatMember[]
  sentMessages Message[]    @relation("SentMessages")

  /* ---- NOTIFICATIONS ---- */
  notifications Notification[]

  /* ---- AUTH ---- */
  accounts Account[]
  sessions Session[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([currentCityId])
}

/**
 * -------------------------- USER PROFILE ---------------------------
 */
model UserProfile {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  /* ---- INFO ---- */
  firstName   String?
  lastName    String?
  occupation  String?
  birthday    DateTime?
  description String?
  gender      Gender?

  /* ---- LANGUAGE ---- */
  languages String[] @default([])

  /* ---- HOME BASE ---- */
  homeBaseCityId String? @db.ObjectId
  homeBaseCity   City?   @relation("HomeBase", fields: [homeBaseCityId], references: [id])

  /* ---- TRAVEL PERSONA ---- */
  persona Json? // { dailyRhythm, travelStyle, interests }
  socials Json? // { instagram, tiktok }

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([birthday])
  @@index([languages])
}
