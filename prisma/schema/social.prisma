// ============================================
// SOCIAL DOMAIN
// ============================================
// Friendship connections and travel history

/**
 * ------------------------- FRIENDSHIP -------------------------
 */
model Friendship {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  requesterId String       @db.ObjectId
  addresseeId String       @db.ObjectId
  status      FriendStatus @default(PENDING)

  blockedById String? @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  requester User @relation("FriendshipsRequested", fields: [requesterId], references: [id], onDelete: Cascade)
  addressee User @relation("FriendshipsReceived", fields: [addresseeId], references: [id], onDelete: Cascade)

  @@unique([requesterId, addresseeId])
  @@index([requesterId])
  @@index([addresseeId])
  @@index([status])
}

/**
 * ------------------------- CITY VISIT (Travel History) -------------------------
 */
enum VisitSource {
  AUTO
  MANUAL
}

model CityVisit {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  cityId String @db.ObjectId
  city   City   @relation(fields: [cityId], references: [id], onDelete: Cascade)

  startDate DateTime @default(now())
  endDate   DateTime? // null = current/active visit

  source     VisitSource @default(MANUAL)
  isVerified Boolean     @default(false)

  // Optional: store entry/exit coordinates for detailed tracking
  entryCoords Json? // GeoJSON Point { type: "Point", coordinates: [lng, lat] }
  exitCoords  Json? // GeoJSON Point

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, endDate]) // Query for current location (endDate = null)
  @@index([userId, startDate]) // Query travel history chronologically
  @@index([cityId])
}

/**
 * ------------------------- NOTIFICATION -------------------------
 */
enum NotificationType {
  MESSAGE
  FRIEND_REQUEST
  FRIEND_ACCEPT
  PASSPORT_STAMPED
  SYSTEM
}

model Notification {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type    NotificationType
  title   String
  message String
  data    Json? // Optional contextual data (e.g. { chatId, friendId, cityId })

  isRead Boolean @default(false)
  isSeen Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, isRead])
  @@index([userId, createdAt])
}

/**
 * ------------------------- FAVORITE -------------------------
 */
enum FavoriteType {
  COUNTRY
  CITY
  PLACE
}

model Favorite {
  id        String       @id @default(auto()) @map("_id") @db.ObjectId
  userId    String       @db.ObjectId
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      FavoriteType
  entityId  String       @db.ObjectId // ID of Country, City, or Place

  createdAt DateTime     @default(now())

  @@unique([userId, type, entityId])
  @@index([userId, type])
}
